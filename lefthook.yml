# Lefthook configuration for Suplementia
# https://github.com/evilmartians/lefthook
#
# Strategy:
# - pre-commit: Fast checks on staged files (lint, type-check, lambda builds)
# - pre-push: Build verification only (type-check + build)
# - CI/CD: Full test suite runs on GitHub Actions
#
# This prevents slow local pushes while ensuring code quality through CI/CD.

pre-commit:
  parallel: true
  commands:
    lint:
      glob: "*.{js,jsx,ts,tsx}"
      run: ./node_modules/.bin/eslint {staged_files} --max-warnings 0
      stage_fixed: true

    type-check:
      glob: "*.{ts,tsx}"
      run: npm run type-check

    lambda-content-enricher:
      root: "backend/lambda/content-enricher"
      glob: "*.ts"
      run: npm run build

    lambda-studies-fetcher:
      root: "backend/lambda/studies-fetcher"
      glob: "*.ts"
      run: npm run build

pre-push:
  parallel: true
  commands:
    type-check:
      run: npm run type-check

    build:
      run: npm run build

    # Lambda tests (fast, isolated)
    lambda-tests:
      root: "backend/lambda/content-enricher"
      run: npm test
